<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ggsci Color Explorer [Hengbin]</title>
<style>
html { font-size: 1.2em; }
body { font-family: Arial, sans-serif; background-color: white; margin:0; padding:0; display:flex; justify-content:center;}
.container { width:95%; max-width:1400px; display:flex; flex-wrap:wrap; gap:30px; margin-top:30px;}

/* Left panel */
.left-panel { flex:1 1 300px; display:flex; flex-direction:column; align-items:center; min-width:250px; padding:15px; border-radius:10px; background-color:#fafafa; box-shadow:0 3px 8px rgba(0,0,0,0.05);}
.controls { display:flex; flex-wrap:wrap; gap:15px; align-items:center; margin-bottom:15px;}
#paletteContainer { display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-start; margin-bottom:15px;}
.color-box { width:36px; height:36px; cursor:pointer; border:1px solid #ccc; border-radius:6px; transition:transform 0.2s;}
.color-box:hover { transform:scale(1.1); }
#colorMaxInfo { margin-bottom:1em; color:#555; font-weight:500; }
#customColorContainer { display:none; width:100%; flex-direction:column; align-items:center; margin-top:10px;}
.circular-palette-wrapper { position:relative; width:100%; max-width:288px; display:flex; flex-direction:column; align-items:center; margin-top:10px;}
.circular-palette { position:relative; width:100%; padding-bottom:100%; border-radius:50%; }
.circular-palette .ring-color { position:absolute; width:36px; height:36px; border-radius:50%; cursor:pointer; border:1px solid #fff; transition:transform 0.2s;}
.circular-palette .ring-color:hover { transform:scale(1.2);}
#generatedColors { display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-start; margin-top:37px;}

/* Middle selected colors */
.middle-panel { flex:0 0 120px; display:flex; flex-direction:column; align-items:center; min-width:120px;}
.selected-list { border:1px solid #ccc; border-radius:10px; padding:1em; flex:1; display:flex; flex-direction:column; gap:8px; overflow-y:auto; width:100%;}

/* Right color codes */
.right-panel { flex:0 0 180px; min-width:150px;}
.selected-labels { border:1px solid #ccc; border-radius:10px; padding:1em; display:flex; flex-direction:column; gap:8px; max-height:400px; overflow-y:auto;}
.export-buttons { margin-top:15px; display:flex; flex-direction:column; gap:10px;}
button { padding:0.6em 1em; border-radius:0.5em; border:1px solid #aaa; cursor:pointer; background-color:#f3f3f3; font-size:1.05em;}
button:hover { background-color:#e5e5e5; transform:scale(1.05);}
select, input[type=number] { font-size:1em; padding:0.4em 0.6em;}
h2 { font-size:1.5em; margin-bottom:0.8em;}
h3 { font-size:1.2em; margin-bottom:0.5em;}
@media(max-width:900px){ .container { flex-direction:column; align-items:center; gap:25px;} .middle-panel,.right-panel { flex:1 1 100%; width:95%; } }
</style>
</head>
<body>
<div class="container">
  <!-- Left panel -->
  <div class="left-panel">
    <h2>ðŸŽ¨ ggsci Color Palettes [Hengbin]</h2>
    <div class="controls">
      <label>Type:</label>
      <select id="typeSelect">
        <option value="discrete">Discrete</option>
        <option value="continuous">Continuous</option>
      </select>

      <label>Palette:</label>
      <select id="paletteSelect"></select>

      <label id="countLabel">Count:</label>
      <input type="number" id="colorCount" min="3" max="30" value="10">
    </div>

    <div id="colorMaxInfo"></div>

    <div id="paletteContainer"></div>

    <div id="customColorContainer">
      <h3>Custom Color Ring</h3>
      <div class="circular-palette-wrapper">
        <div class="circular-palette" id="circularPalette"></div>
        <div id="generatedColors"></div>
      </div>
    </div>
  </div>

  <!-- Middle selected colors -->
  <div class="middle-panel">
    <h3>Selected Colors</h3>
    <div id="selectedColors" class="selected-list"></div>
  </div>

  <!-- Right color codes -->
  <div class="right-panel">
    <h3>Color Codes</h3>
    <div id="selectedLabels" class="selected-labels"></div>
    <div class="export-buttons">
      <button id="exportCSV">Export CSV</button>
      <button id="exportJSON">Export JSON</button>
      <button id="exportR">Export R Vector</button>
    </div>
  </div>
</div>

<script>
// Discrete and continuous palettes
const discretePalettes = {
 "npg_10": { max: 10, colors: ['#E64B35','#4DBBD5','#00A087','#3C5488','#F39B7F','#8491B4','#91D1C2','#DC0000','#7E6148','#B09C85'] },
 // ... (other palettes remain unchanged)
};
const continuousPalettes = {
  red: ['#fff5f0','#fcbba1','#fb6a4a','#de2d26','#a50f15'],
  blue: ['#f7fbff','#deebf7','#9ecae1','#3182bd','#08519c'],
  green: ['#f7fcf5','#c7e9c0','#74c476','#238b45','#00441b'],
  custom: []
};

// DOM
const typeSelect = document.getElementById("typeSelect");
const paletteSelect = document.getElementById("paletteSelect");
const paletteContainer = document.getElementById("paletteContainer");
const colorCountInput = document.getElementById("colorCount");
const customColorContainer = document.getElementById("customColorContainer");
const circularPalette = document.getElementById("circularPalette");
const generatedColors = document.getElementById("generatedColors");
const selectedColorsDiv = document.getElementById("selectedColors");
const selectedLabelsDiv = document.getElementById("selectedLabels");
const colorMaxInfo = document.getElementById("colorMaxInfo");

// Initialize
function updatePaletteOptions(){
  paletteSelect.innerHTML = "";
  const palettes = typeSelect.value === "discrete" ? discretePalettes : continuousPalettes;
  for(const name in palettes){
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    paletteSelect.appendChild(opt);
  }
  updateCountLimit();
  renderPalette();
}
updatePaletteOptions();

// Event listeners
typeSelect.addEventListener("change", updatePaletteOptions);
paletteSelect.addEventListener("change", () => { updateCountLimit(); renderPalette(); });
colorCountInput.addEventListener("input", renderPalette);

// Update count limits
function updateCountLimit(){
  const type = typeSelect.value;
  const paletteName = paletteSelect.value;
  if(type==="discrete"){
    const max = discretePalettes[paletteName].max;
    colorCountInput.max = max;
    colorCountInput.value = Math.min(parseInt(colorCountInput.value), max);
    colorMaxInfo.textContent = `Maximum colors: ${max}`;
  }else{
    colorCountInput.max = 30;
    colorMaxInfo.textContent = "";
  }
}

// Render palette
function renderPalette(){
  paletteContainer.innerHTML="";
  generatedColors.innerHTML="";
  customColorContainer.style.display="none";
  const type = typeSelect.value;
  const paletteName = paletteSelect.value;
  const count = parseInt(colorCountInput.value);
  let colors = [];

  if(type==="discrete"){
    colors = discretePalettes[paletteName].colors.slice(0,count);
    colors.forEach(color=>{
      const div = document.createElement("div");
      div.className="color-box";
      div.style.backgroundColor=color;
      div.onclick=()=>addColor(color);
      paletteContainer.appendChild(div);
    });
  }else{
    if(paletteName==="custom"){
      customColorContainer.style.display="flex";
      generateCircularPalette();
      return;
    }else{
      const base = continuousPalettes[paletteName];
      for(let i=0;i<count;i++){
        const idx = Math.floor(i*(base.length-1)/(count-1));
        colors.push(base[idx]);
      }
    }
    colors.forEach(color=>{
      const div=document.createElement("div");
      div.className="color-box";
      div.style.backgroundColor=color;
      div.onclick=()=>addColor(color);
      paletteContainer.appendChild(div);
    });
  }
}

// Add color to selected list
function addColor(color){
  const box = document.createElement("div");
  box.className="color-box";
  box.style.backgroundColor=color;
  box.onclick=()=>{ box.remove(); label.remove(); };
  selectedColorsDiv.appendChild(box);

  const label = document.createElement("div");
  label.textContent=color;
  label.style.fontSize="0.9em";
  selectedLabelsDiv.appendChild(label);
}

// Custom color ring
function generateCircularPalette(){
  circularPalette.innerHTML="";
  const size = circularPalette.offsetWidth;
  const center = size/2;
  const rings=4, perRing=24;
  for(let r=1;r<=rings;r++){
    for(let i=0;i<perRing;i++){
      const hue = i*360/perRing;
      const lightness = 95 - r*15;
      const color = `hsl(${hue}, 80%, ${lightness}%)`;
      const div=document.createElement("div");
      div.className="ring-color";
      const angle=(i/perRing)*2*Math.PI;
      const radius=(size/10) + r*(size/10);
      div.style.left=`${center + radius*Math.cos(angle) - 18}px`;
      div.style.top=`${center + radius*Math.sin(angle) - 18}px`;
      div.style.backgroundColor=color;
      div.onclick=()=>generateGradient(color);
      circularPalette.appendChild(div);
    }
  }
}

// HSL -> HEX
function hslToHex(h,s,l){
  s/=100;l/=100;
  const k=n=>(n+h/30)%12;
  const a=s*Math.min(l,1-l);
  const f=n=>l-a*Math.max(-1,Math.min(k(n)-3,9-k(n),1));
  const toHex=x=>Math.round(255*x).toString(16).padStart(2,'0');
  return `#${toHex(f(0))}${toHex(f(8))}${toHex(f(4))}`;
}

// Generate gradient
function generateGradient(baseColor){
  generatedColors.innerHTML="";
  const count=parseInt(colorCountInput.value);
  const [h,s,l]=baseColor.match(/\d+/g).map(Number);
  for(let i=0;i<count;i++){
    const light=95-(i*60/(count-1));
    const hex=hslToHex(h,s,light);
    const div=document.createElement("div");
    div.className="color-box";
    div.style.backgroundColor=hex;
    div.onclick=()=>addColor(hex);
    generatedColors.appendChild(div);
  }
}

// Export functions
function getSelectedColors(){ return Array.from(selectedLabelsDiv.children).map(d=>d.textContent);}
function download(filename,text){ const blob=new Blob([text],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click();}
document.getElementById("exportCSV").onclick=()=>download("colors.csv",getSelectedColors().join("\n"));
document.getElementById("exportJSON").onclick=()=>download("colors.json",JSON.stringify(getSelectedColors(),null,2));
document.getElementById("exportR").onclick=()=>{
  const arr=getSelectedColors().map(c=>`"${c}"`).join(", ");
  download("colors.R",`c(${arr})`);
};
</script>
</body>
</html>
